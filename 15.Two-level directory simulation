#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_USERS 10
#define MAX_FILES 20
#define NAME_LEN 32

typedef struct {
    char name[NAME_LEN];
    int fcount;
    char files[MAX_FILES][NAME_LEN];
} UserDir;

UserDir users[MAX_USERS];
int userCount = 0;

int findUser(char *name) {
    for (int i=0;i<userCount;i++) if (strcmp(users[i].name,name)==0) return i;
    return -1;
}

void createUser() {
    if (userCount==MAX_USERS) { printf("Max users reached\n"); return; }
    char name[NAME_LEN];
    printf("Enter user name: "); scanf("%s", name);
    if (findUser(name)!=-1) { printf("User exists\n"); return; }
    strcpy(users[userCount].name, name);
    users[userCount].fcount = 0;
    userCount++;
    printf("User created\n");
}

void createFile() {
    char uname[NAME_LEN], fname[NAME_LEN];
    printf("Enter user: "); scanf("%s", uname);
    int idx = findUser(uname);
    if (idx==-1) { printf("User not found\n"); return; }
    if (users[idx].fcount==MAX_FILES) { printf("User file limit reached\n"); return; }
    printf("Enter file name: "); scanf("%s", fname);
    for (int i=0;i<users[idx].fcount;i++) if (strcmp(users[idx].files[i],fname)==0) { printf("File exists\n"); return; }
    strcpy(users[idx].files[users[idx].fcount++], fname);
    printf("File created\n");
}

void deleteFile() {
    char uname[NAME_LEN], fname[NAME_LEN];
    printf("Enter user: "); scanf("%s", uname);
    int idx = findUser(uname);
    if (idx==-1) { printf("User not found\n"); return; }
    printf("Enter file to delete: "); scanf("%s", fname);
    int i;
    for (i=0;i<users[idx].fcount;i++) if (strcmp(users[idx].files[i],fname)==0) break;
    if (i==users[idx].fcount) { printf("File not found\n"); return; }
    strcpy(users[idx].files[i], users[idx].files[users[idx].fcount-1]);
    users[idx].fcount--;
    printf("File deleted\n");
}

void display() {
    if (userCount==0) { printf("No users\n"); return; }
    for (int i=0;i<userCount;i++) {
        printf("User: %s\n", users[i].name);
        if (users[i].fcount==0) printf("  (no files)\n");
        for (int j=0;j<users[i].fcount;j++) printf("  %s\n", users[i].files[j]);
    }
}

int main() {
    int ch;
    while (1) {
        printf("\n1.Create User 2.Create File 3.Delete File 4.Display 5.Exit\nChoice: ");
        if (scanf("%d",&ch)!=1) break;
        switch(ch) {
            case 1: createUser(); break;
            case 2: createFile(); break;
            case 3: deleteFile(); break;
            case 4: display(); break;
            case 5: exit(0);
            default: printf("Invalid\n");
        }
    }
    return 0;
}
